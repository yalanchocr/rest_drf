; supervisor config file

[unix_http_server]
file=/var/run/supervisor.sock   ; (the path to the socket file)
chmod=0700                       ; sockef file mode (default 0700)

[supervisord]
logfile=/var/log/supervisor/supervisord.log ; (main log file;default $CWD/supervisord.log)
pidfile=/var/run/supervisord.pid ; (supervisord pidfile;default supervisord.pid)
childlogdir=/var/log/supervisor            ; ('AUTO' child log dir, default $TEMP)

; the below section must remain in the config file for RPC
; (supervisorctl/web interface) to work, additional interfaces may be
; added by defining them in separate rpcinterface: sections
[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

[supervisorctl]
serverurl=unix:///var/run/supervisor.sock ; use a unix:// URL  for a unix socket

;[include]
;files = /etc/supervisor/conf.d/*.conf

################################

[program:gunicorn]
command=gunicorn --bind unix:/app/sina/sina.sock --worker-class=gevent --worker-connections=100 --max-requests 1 --workers=10 --timeout 240 --access-logfile=/var/log/gunicorn/access.log --error-logfile=/var/log/gunicorn/error.log  backend.wsgi:application
stdout_logfile=/var/log/gunicorn/access.log
stderr_logfile=/var/log/gunicorn/error.log

[program:nginx]
command=/usr/sbin/nginx -g "daemon off;"
autostart=true
autorestart=true
startretries=5
numprocs=1
startsecs=0
;process_name=%(program_name)s_%(process_num)02d
;stderr_logfile=/var/log/supervisor/%(program_name)s_stderr.log
;stderr_logfile_maxbytes=10MB
;stdout_logfile=/var/log/supervisor/%(program_name)s_stdout.log
;stdout_logfile_maxbytes=10MB


[program:qcluster]
;command=/usr/bin/python3.10 -m gunicorn app:app -w $((2 * $(getconf _NPROCESSORS_ONLN) + 1)) -k uvicorn.workers.UvicornWorker -b unix:/app/unix.sock
command=/usr/bin/python3.10 manage.py qcluster 
stdout_logfile=/var/log/qcluster/access.log
stderr_logfile=/var/log/qcluster/error.log
